<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <title>내 영양제 목록</title>
</head>
<body>

    <div class="top-bar">
        <div class="top-left">
            <a th:href="@{/}">홈</a>
        </div>
        <div class="top-right">
            <div th:if="${session.loginMember} == null">
                <a th:href="@{/members/login}">로그인</a>
                <a th:href="@{/members/register}">회원가입</a>
            </div>
            <div th:if="${session.loginMember} != null">
                <span th:text="${session.loginMember.nickname} + ' 님'"></span>
                <a th:href="@{/members/me}">내 정보</a>
                <a th:href="@{/members/logout}">로그아웃</a>
            </div>
        </div>
    </div>

    <h1>내 영양제 목록</h1>

    <div style="text-align: center; margin-bottom: 40px;">
        <a th:href="@{/supplements/new}" class="custom-btn">
            + 새 영양제 등록
        </a>
    </div>

    <div th:if="${#lists.isEmpty(supplements)}"
         style="text-align: center; color: #888; margin-top: 50px;">
        <p>
            등록된 영양제가 없습니다. <br/>
            위 버튼을 눌러 추가해보세요!
        </p>
    </div>

    <div class="card-grid" th:if="${!#lists.isEmpty(supplements)}">

        <div class="supplement-card" th:each="s, stat : ${supplements}">

            <div class="card-badge" th:text="${stat.count}">1</div>

            <img th:if="${s.imagePath != null}"
                 th:src="${s.imagePath}"
                 alt="제품 이미지"
                 class="card-img"/>
            <div th:if="${s.imagePath == null}"
                 class="card-img"
                 style="display:flex; align-items:center; justify-content:center; color:#aaa;">
                No Img
            </div>

            <div class="card-title" th:text="${s.name}">제품명</div>
            <div class="card-brand" th:text="${s.brand}">브랜드명</div>

            <div class="card-tags" style="margin-bottom: 10px;">
                <span th:if="${s.tags == null or #strings.isEmpty(s.tags)}"
                      style="font-size: 12px; color:#ccc;">
                    -
                </span>
                <span th:each="tag : ${#strings.listSplit(s.tags, ',')}"
                      th:text="${tag}"
                      class="tag-pill">
                    태그
                </span>
            </div>

            <p style="font-size: 13px; color: #666; margin-bottom: 15px; height: 40px; overflow: hidden;">
                <span th:text="${s.memo}">메모 내용</span>
            </p>

            <div style="font-size: 12px; color:#555; margin-bottom: 15px; background: #f9f9f9; padding: 10px; border-radius: 10px; width: 100%; box-sizing: border-box;">
                <div th:if="${s.normalizedSupplement != null}">
                    <strong th:text="${s.normalizedSupplement.productName}">제품명</strong><br/>
                    <span th:text="${s.normalizedSupplement.companyName}" style="color:#888;">업소명</span>
                    <div th:text="${s.normalizedSupplement.mainFunction}" style="margin-top:5px; color:#444;">주요 기능성</div>
                </div>
                <div th:if="${s.normalizedSupplement == null}" style="color:#999;">
                    식약처 정보 미연결
                </div>
            </div>

            <div class="card-actions">
                <div style="margin-bottom: 10px;">
                    <a th:if="${s.normalizedSupplement == null}"
                       th:href="@{|/supplements/${s.id}/link|}"
                       class="status-link warning">
                       ⚠️ 식약처 정보 연결하기
                    </a>

                    <a th:if="${s.normalizedSupplement != null}"
                       th:href="@{|/supplements/${s.id}/link|}"
                       class="status-link success">
                       ✅ 연결됨 (정보 수정)
                    </a>
                </div>

                <a th:href="@{/supplements/{id}/edit(id=${s.id}, memberId=${memberId})}"
                   class="custom-btn btn-sm">
                    수정
                </a>

                <form th:action="@{|/supplements/${s.id}/delete|}"
                      method="post"
                      style="display:inline;">
                    <button type="submit"
                            class="custom-btn btn-sm btn-gray"
                            onclick="return confirm('정말 삭제할까요?');">
                        삭제
                    </button>
                </form>
            </div>
        </div></div></body>
</html>