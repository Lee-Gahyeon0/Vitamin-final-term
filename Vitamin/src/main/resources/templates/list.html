<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>내 영양제 목록</title>
</head>
<body>
<!-- [공통 헤더] 로그인 상태에 따라 다르게 -->
<div class="top-bar">
    <!-- 왼쪽 : 홈 -->
    <div class="top-left">
        <a th:href="@{/}">홈</a>
    </div>

    <!-- 오른쪽 : 로그인/회원가입 or 사용자 정보 -->
    <div class="top-right">
        <!-- 비로그인 -->
        <div th:if="${session.loginMember} == null">
            <a th:href="@{/members/login}">로그인</a>
            <a th:href="@{/members/register}">회원가입</a>
        </div>

        <!-- 로그인 상태 -->
        <div th:if="${session.loginMember} != null">
            <span th:text="${session.loginMember.nickname} + ' 님'"></span>
            <a th:href="@{/members/me}">내 정보</a>
            <a th:href="@{/members/logout}">로그아웃</a>
        </div>
    </div>
</div>

		<h1>내 영양제 목록</h1>
			<div>
    		<!-- 새 영양제 등록 버튼 -->
    		<a th:href="@{/supplements/new}">+ 영양제 추가하기</a>
		</div>
		
		<hr/>

		<table border="1" cellpadding="8">
		    <thead>
		    <tr>
		        <th>번호</th>
		        <th>이름</th>
		        <th>브랜드</th>
		        <th>태그</th>
		        <th>메모</th>
		        <th>식약처 정보</th>
				<th>관리</th>  
		    </tr>
		    </thead>
		    <tbody>

		    <!-- 영양제가 하나도 없을 때 -->
		    <tr th:if="${#lists.isEmpty(supplements)}">
		        <td colspan="6">
		            등록된 영양제가 없습니다. 상단의 '영양제 추가하기'를 눌러 등록해보세요.
		        </td>
		    </tr>

		    <!-- supplements: List<Supplement> -->
		    <tr th:each="s, stat : ${supplements}"
		        th:if="${s != null}">
		        <td th:text="${stat.count}">1</td>
		        <td th:text="${s.name}">제품명</td>
		        <td th:text="${s.brand}">브랜드</td>
		        <td th:text="${s.tags}">태그</td>
		        <td th:text="${s.memo}">메모</td>

		        <!-- 식약처 정보 칸 -->
				<td>
				    <!-- 이미 식약처 제품이 연결된 경우 -->
				    <div th:if="${s.rawProduct != null}">
				        <!-- 제품명 / 회사명 -->
				        <p style="margin: 0 0 4px 0;">
				            <strong th:text="${s.rawProduct.productName}">제품명</strong><br/>
				            <span th:text="${s.rawProduct.companyName}">업소명</span>
				        </p>

				        <!-- 주된 기능성 : 줄 잘 바뀌게 -->
				        <p style="margin: 0; font-size:0.9em; line-height:1.4;">
				            <span th:text="${s.rawProduct.mainFunction}">
				                주된 기능성
				            </span>
				        </p>

				        <!-- 링크는 살짝 띄워서 밑에 배치 -->
				        <p style="margin: 6px 0 0 0;">
				            <a th:href="@{|/supplements/${s.id}/link|}">
				                다른 제품으로 변경
				            </a>
				        </p>
				    </div>

				    <!-- 아직 연결 안 된 경우 -->
				    <div th:if="${s.rawProduct == null}">
				        <p style="margin: 0 0 4px 0; font-size:0.9em; color:#888;">
				            아직 식약처 정보가 연결되지 않았습니다.
				        </p>
				        <p style="margin: 0;">
				            <a th:href="@{|/supplements/${s.id}/link|}">
				                식약처 제품 연결
				            </a>
				        </p>
				    </div>
				</td>
				
				<!-- 관리 컬럼 -->
				   <td>
					<a th:href="@{/supplements/{id}/edit(id=${s.id}, memberId=${memberId})}">
					            수정
					 </a>
				       |
					   <form th:action="@{|/supplements/${s.id}/delete|}"method="post" style="display:inline;">
					          <button type="submit"onclick="return confirm('정말 삭제할까요?');">
					              삭제
					          </button>
					      </form>
				   </td>
		    </tr>



    </tbody>
</table>
</body>
</html>
